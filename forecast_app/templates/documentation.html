{% extends "base.html" %}

{% block title %}Zoltar User Guide{% endblock %}

{% block content %}

    <h1>Zoltar User Guide<a id="zoltar-user-guide"></a></h1>

    <p><em>This is draft documentation of how to use Zoltar.</em></p>


    <h1>Table of contents<a id="table-of-contents"></a></h1>

    <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#home-page">Zoltar Home page</a></li>
        <li><a href="#project-detail-page">Project detail page</a>
            <ul>
                <li><a href="#project-details-table">Project details table</a></li>
                <li><a href="#forecast-models">Forecast models</a></li>
                <li><a href="#forecast-models">Forecast models</a></li>
                <li><a href="#locations">Locations</a></li>
                <li><a href="#targets">Targets</a></li>
                <li><a href="#time-zeros">Time zeros</a></li>
            </ul>
        </li>
        <li><a href="#model-detail-page">Model detail page</a>
            <ul>
                <li><a href="#model-details-table">Model details table</a></li>
                <li><a href="#forecasts">Forecasts</a></li>
            </ul>
        </li>
        <li><a href="#data-analysis">Data analysis</a>
            <ul>
                <li><a href="#visualizations">Visualizations</a></li>
                <li><a href="#scores">Scores</a></li>
            </ul>
        </li>
        <li><a href="#for-technical-users">For technical users</a>
            <ul>
                <li><a href="#api">API</a></li>
                <li><a href="#forecast-data-format">Forecast data format</a></li>
            </ul>
        </li>
    </ul>


    <h1>Introduction<a id="introduction"></a></h1>

    <p>The Zoltar forecast archive is a web application to develop ideas for a repository of model forecast results.
        Until now, predictions made by models have been stored in differing formats and locations. This complicates
        tracking, comparing, and revisiting forecasts. Zoltar supports storing, retrieving, comparing, and analyzing
        time series forecasts for prediction challenges of interest to the modeling community.</p>

    <p>This document is a first draft of a user guide covering Zoltar's main features.</p>

    <p>Note: Presently the site is under beta test. If you have questions about it or want an account, please contact
        Professor Nicholas Reich (nick@schoolph.umass.edu>), director of the
        <a href="http://reichlab.io/">Reich Lab</a>.</p>


    <h1>Zoltar Home page<a id="home-page"></a></h1>

    <p>The home page lists all of the projects in the archive. A <strong>project</strong> is a collection of
        <strong>forecast models</strong> and their <strong>forecasts</strong>, and is described in more detail below.
        This page shows basic project information, including name, owner, description, and (in the "Objects" column) a
        summary of the number of models and forecasts in the project. (This number is an estimate.)</p>

    <p>At the page's top is a header that's shown on all pages. It contains three icons: Home page (the Zoltar crystal
        ball in the upper left), and on the right a user drop down menu and a help (question mark) icon on the far
        right. The drop down menu's appearance depends on whether a user is logged in. If so then it's text is the user
        name and the menu items are links to the user profile page, and a logout item. If the user is not logged in then
        "Sign in" is shown. Clicking it takes you to a typical login page where you specify your account's user name and
        password.</p>

    <p>Clicking a project name takes you to its detail page.</p>

    <p>Creating projects: Any logged in user can create projects via the "New" button towards the top. Clicking it will
        take you to a form where you can fill in the details described below.</p>


    <h1>Project detail page<a id="project-detail-page"></a></h1>

    <p>A <strong>project</strong> is the main element for representing a forecasting challenge. It has an
        <strong>owner</strong> (a registered user in the system), and zero or more <strong>model owners</strong> (also
        users). A project owner can do anything to the project, including what model owners can do, but model owners are
        limited to creating, editing, and deleting Models, and uploading and deleting forecasts. (To become a model
        owner you must contact the project owner.)</p>

    <p>Each project's detail page is divided into four vertical sections, described next: Details table, forecast
        models, targets, and time zeros.</p>


    <h2>Project details table<a id="project-details-table"></a></h2>

    <p>At the top of the page is a table showing non-model information related to the project:</p>

    <ul>
        <li><em>Summary</em>: The same summary as on the home page: An estimate of the number of models and forecasts in
            the project.
        </li>
        <li><em>Owner</em>: The user that has full control of the project, and includes authorization to view, edit, and
            delete anything (models, forecasts, etc.) The owner is the user that created the project (which is done on
            the home page).
        </li>
        <li><em>Model owners</em>: A list of users who can view the project (applicable only if the project is private),
            and who can create and delete models, and upload and delete forecasts. The project owner controls specifies
            model owners when she creates or edits the project.
        </li>
        <li><em>Time Interval Type</em>: Tells the <a href="https://github.com/reichlab/d3-foresight">D3 Foresight
            component</a> what its x-axis label should be. Choices: Week, Biweek, or Month.
        </li>
        <li><em>Visibility</em>: A project can be either public or private, which controls project visibility, including
            accessing data. This applies to list and detail pages, along with API endpoints. Public projects are
            available to anybody, users and anonymous visitors included. Private projects can only be viewed by project
            owners and model owners. This means that in order to grant a user access to a private account, the project
            owner must add her to the project's model owners list, even if that user will not be managing any models.
        </li>
        <li><em>Description</em>: Prose provided by project owner. It should cover the following topics:
            <ul>
                <li>Information about the "real-time-ness" of data, i.e., revised/unrevised.</li>
                <li>Details about how models interpret time zeros and data version dates.</li>
                <li>Data file naming scheme.</li>
            </ul>
        </li>
        <li><em>Home</em>: A link to the project's home page, which might include details about any competitions, source
            code, team members, included models, etc.
        </li>
        <li><em>Core data</em>: A link to a page that contains data (e.g., CSV files) used to train models. For model
            competitions, it should include all data sets made available to everyone in the challenge, including
            supplemental data like Google queries or weather data. Ideally Zoltar users interested in re-running a
            project's models have all they need in the home and core data directories. However, they are not used
            directly by Zoltar.
        </li>
        <li><em>Data template</em>: Either a link to the project's template (if one has been uploaded), or an upload
            button for (visible only for the project owner). Clicking the link takes you to a template detail page that
            includes a data preview plus a <strong>Download</strong> button. About templates:
            <ul>
                <li>The template is a data file that is used to validate uploaded forecasts.</li>
                <li>It is the same CDC format as forecasts (see below), i.e., a CSV file containing points and bins,
                    with these columns: <code>Location, Target, Type, Unit, Bin_start_incl, Bin_end_notincl,
                        Value</code>.
                    TBD: Details re: how used for validate.
                </li>
                <li>There are no file name restrictions.</li>
            </ul>
        </li>
        <li><em>Truth data</em>: Similar to the template, this is a data file that the project owner uploads. This data
            contains observed target values for time zeros and locations in the project, and is a project-agnostic way
            to capture actual values that models predicted for. It is used to calculate scores, and to extract the
            'actual' data used in the D3 component's TimeChart. Each Project is responsible for generating a truth table
            csv file in a project-specific manner. Details:
            <ul>
                <li>CSV file</li>
                <li>No file name restrictions</li>
                <li>Columns: <code>Timezero, Location, Target, Value</code>.</li>
            </ul>
        </li>
        <li><em>Analysis</em>: Links to visualization and score pages (see below for details).</li>
        <li><em>Configuration</em>: A "catch all" <a href="https://www.json.org/">JSON</a> object used to configure
            projects. It currently contains one key:
            <ul>
                <li><code>visualization-y-label</code>: A string used for the y-axis in the D3 component's TimeChart.
                </li>
            </ul>
        </li>
    </ul>


    <h2>Forecast models<a id="forecast-models"></a></h2>

    <p>The <strong>Models</strong> section lists the project's forecast models by name, with links to model detail pages
        (see details below). If you're a project owner or model owner then a "New" button is shown that takes you to a
        form for creating a model.</p>


    <h2>Locations<a id="locations"></a></h2>

    <p>This section lists names of the locations in the project. These were either defined by project owner when
        creating the project, or were created automatically when the project template was loaded and a referenced
        location was not found.
    </p>


    <h2>Targets<a id="targets"></a></h2>

    <p>This section lists information about project forecast targets. Like locations, these were either created
        explicitly by the project owner, or automatically when the template was loaded. The information includes the
        following fields.
    </p>
    <p>(A note regarding auto-created targets. Auto-created targets require further, careful editing to be complete. In
        particular, users must fill in the <em>description</em> and <em>unit</em> fields, identify the date-related
        ones by checking <em>Is date</em>, and check <em>Is step ahead</em> and fill in the
        <em>Step ahead increment</em> integer value. <u>Importantly</u>: You will get unwanted results if
        <em>Is date</em> or <em>Is step ahead</em> is incorrect.)
    </p>

    <ul>
        <li><em>Name</em>: Self-explanatory.</li>
        <li><em>Description</em>: "". For auto-created targets, this field must be filled in.</li>
        <li><em>Unit</em>: E.g., "percent" or "week". Unit is used when previewing data, and when downloading it. For
            auto-created targets, ensure that you've entered a unit. Otherwise it will be blank in previews and
            downloads.
        </li>
        <li><em>Date?</em>: This identifies whether the target is date-related or not. Examples of date-related targets
            might include "Season onset" or "Season peak week". For auto-created targets, the consequences of not
            checking off this field include forecasts being rejected as invalid if they have no point value.
        </li>
        <li><em>Step Ahead?</em>: Shows two pieces of information: 1) Whether the target is a "step ahead" one, and
            (if so) 2) what the "step ahead increment" is. (Step ahead targets are used to predict values in the
            future, and are used by some analysis tools.)
        </li>
    </ul>


    <h2>Time zeros<a id="time-zeros"></a></h2>

    <p>This section details the project's <strong>time zeros</strong>. About time zeros and <strong>data version
        dates</strong>: Because the forecasting field does not have standard terminology, we have settled on the
        following two concepts for this application. Note that some time zeros are tagged as starting a season,
        specifying the season's name, which helps to segment the time zeros. Zoltar uses season information in the
        visualization and score pages, where the user can select which season to show data for. This also helps to keep
        performance up.
    </p>

    <ul>
        <li><em>Time zero</em>: The date from which a forecast originates and to which targets are relative (i.e. a
            "2-week-ahead forecast" is two weeks ahead of the time-zero). Every forecast has a time zero.
        </li>
        <li><em>Data version date</em>: An optional additional piece of metadata for a forecast. If it exists, it is
            associated with a time-zero. It refers to the latest date at which any data source used for the forecasts
            should be considered. If present, it can be used externally by system users to recreate model results by
            "rolling back" the core data to a particular state.
        </li>
        <li><em>Starts Season</em>: Shows two pieces of information: 1) Whether the time zero is starts a season (it is
            blank if it does not start a season), and 2) the season name itself (which indicates the time zero does
            start a season.)
        </li>
    </ul>


    <h1>Model detail page<a id="model-detail-page"></a></h1>

    <p>A model is the represention of code that generates forecasts. Clicking on a model link takes you to its detail
        page. The detail page is divided into two vertical sections, described next: Details table and forecasts
        list.</p>

    <h2>Model details table<a id="model-details-table"></a></h2>

    <p>At the top of the page is a table showing information related to the model:
        - <em>Owner</em>: The model's owner. The owner is the user that created the model (which is done on the home
        page), and she can edit or delete the model, and upload or delete its forecasts.
        - <em>Project</em>: A link to the project the model belongs to.
        - <em>Description</em>: Prose provided by model owner. It should include information on reproducing the model's
        results.
        - <em>Home</em>: A link to the model home page.
        - <em>Auxiliary data</em>: An optional link to model-specific data files that were used by the model beyond the
        project's core data. This is not used directly by Zoltar.</p>

    <h2>Forecasts<a id="forecasts"></a></h2>

    <p>The <strong>Forecasts</strong> section lists the model's forecasts, with links to forecast detail pages (see
        details below). Each forecast is data associated with a particular time zero in the project. The data is loaded
        from a file with a specific format (described next). There is one line per time zero, specifying the time zero
        date (but not the data version date), the original forecast data filename that was uploaded, and an
        <strong>Action</strong>button, either a green upload one if there is no data associated with the time zero, or a
        red delete button otherwise. Clicking on the filename link takes you to a forecast detail page that includes a
        data preview plus a <strong>Download</strong> button (currently CSV or JSON formats).</p>

    <p>About forecast file formats: We have adopted the data format used for CDC flu challenges. Details are at
        <a href="https://predict.cdc.gov/api/v1/attachments/flusight/flu_challenge_2016-17_update.docx">flu_challenge_2016-17_update.docx</a>.
        Summary:</p>

    <ul>
        <li>Files are in CSV format, and a header must be included.</li>
        <li>Has these columns:
            <ul>
                <li><code>Location</code>: Location of forecast - either entire country or a particular region</li>
                <li><code>Target</code>: Forecast target</li>
                <li><code>Type</code>: Forecast type - either "Point" for point forecast or "Bin" for probabilistic bin
                </li>
                <li><code>Unit</code>: Unit of forecast, e.g., "week" or "percent"</li>
                <li><code>Bin_start_incl</code>: Inclusive starting value for probabilistic forecast bin</li>
                <li><code>Bin_end_notincl</code>: Exclusive ending value for probabilistic forecast bin</li>
                <li><code>Value</code>: Forecasted point value or probability assigned</li>
            </ul>
        </li>
        <li>Each file contains a mixture of lines for points and binned distributions.</li>
        <li>Point lines look like: <code>US National,Season onset,Point,week,NA,NA,51</code>.</li>
        <li>Bin lines look like: <code>US National,Season onset,Bin,week,40,41,0.0162552067459108</code>.</li>
        <li>(Zoltar-specific standard) File names must match this pattern:
            <code>&lt;time_zero&gt;-&lt;model_name&gt;[-&lt;data_version_date&gt;].cdc.csv</code> . data_version_date
            and its preceding dash are optional. The two dates (<code>time_zero</code> and
            <code>data_version_date</code>) are in <code>YYYYMMDD</code> format.
        </li>
    </ul>


    <h1>Data analysis<a id="data-analysis"></a></h1>
    <p>Zoltar provides two fledgling project analysis tools: visualizations and scores. You will find links to them on
        project detail pages on the Analysis line in the project details section at the top of the page.</p>

    <h2>Visualizations<a id="visualizations"></a></h2>
    <p>This page uses the <a href="https://github.com/reichlab/d3-foresight">D3 Foresight
        component</a>'s TimeChart to display the project's models' forecasts for each step ahead target. Currently we
        only use the basic plot feature along with the <strong>actual</strong> component. We plan to add baseline,
        history, and other features. To use the chart:
        - Select a location and season from the drop downs. (Note that selecting a season will reload the page, which
        can take a long time for large projects.)
        - Click the plot area to move the current time zero, indicated by the vertical division between gray on the left
        and white on the right. The plot shows the step ahead target predictions for each model.
        - Hover over the plot to see details.
        - The legend shows model names, and allows showing or hiding them. Hover over a model name for details, and
        click the link button to show model details in a separate Zoltar page.
        - Click the left and right arrows to the right of the legend to move the current time zero.
        - Click the 'hamburger' icon to toggle the legend.</p>

    <h2>Scores<a id="scores"></a></h2>
    <p>This page shows the mean absolute error values for all models in the project. (This can take a long time to load
        for large projects.) The location and season drop downs work like those on the visualization page. The smallest
        errors are shown in inverse text.</p>


    <h1>For technical users<a id="for-technical-users"></a></h1>

    <h2>API<a id="api"></a></h2>

    <p>We provide the following REST endpoints. All results are JSON. The API is browsable from the root URI on the home
        page (look for <strong>API</strong> buttons), and is a great starting point for developers. Note that all
        projects and users are listed, but private projects, their models, and their forecasts, can only be accessed by
        authorized accounts.</p>

    <p>Endpoints:</p>

    <ul>
        <li><code>api/</code> # browsable API root</li>
        <li><code>api/projects/</code> # list of all projects</li>
        <li><code>api/project/[project_id]/</code> # project detail</li>
        <li><code>api/project/[project_id]/template/</code> # template detail</li>
        <li><code>api/project/[project_id]/template_data/</code> # template, formatted as JSON - see above</li>
        <li><code>api/project/[project_id]/truth/</code> # truth detail</li>
        <li><code>api/project/[project_id]/truth_data/</code> # truth data</li>
        <li><code>api/user/[user_id]/</code> # user detail</li>
        <li><code>api/model/[model_id]/</code> # model detail</li>
        <li><code>api/forecast/[forecast_id]/</code> # forecast detail</li>
        <li><code>api/forecast/[forecast_id]/data/</code> # forecast data as JSON - see above</li>
    </ul>

    <h2>Forecast data format<a id="forecast-data-format"></a></h2>

    <p>Forecast data can be downloaded in either CSV or JSON format. The CSV matches the input file CDC format, but
        the JSON is our own and is structured like this:</p>
    <pre>{'metadata': project_or_forecast_details_object, 'data': data_object}</pre>

    <p>Where <code>project_or_forecast_details_object</code> is an object that's the same as either the Project or
        Forecast detail object. <code>data_object</code> is structured like this:</p>
    <pre>{location1: target_dict_1, location2: target_dict_2, ...}</pre>

    <p>Each <code>target_dict</code> is of the form:</p>
    <pre>
{target1: {'unit': unit1, 'point': point_val1, 'bins': bin_list1},
 target2: {'unit': unit2, 'point': point_val2, 'bins': bin_list2},
 ...
}</pre>

    <p>and each <code>bin_list</code> is like:</p>
    <pre>
[[bin_start_incl1, bin_end_notincl1, value1],
 [bin_start_incl2, bin_end_notincl2, value2],
 ...
]</pre>


{% endblock %}
