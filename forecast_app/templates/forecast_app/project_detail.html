{% extends "base.html" %}

{% block title %}Project: {{ project.name }}{% endblock %}

{% block content %}

    <p class="lead">Project: {{ project.name }}
        <a href="{% url 'api-project-detail' project.pk %}" class="btn btn-info btn-xs" role="button">API</a>
        {% if ok_user_edit_project %}
            {# Edit Project: a simple link to an edit form #}
            &nbsp;
            <a href="{% url 'edit-project' project.pk %}" class="btn btn-success btn-sm" role="button">
                <span class="glyphicon glyphicon-pencil"></span>
            </a>

            {# Delete Project: a button that shows a hidden confirm modal when clicked #}
            <button type="submit" class="btn btn-danger btn-sm" data-toggle="modal"
                    data-target="#confirmModal_{{ project.html_id }}">
                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
            </button>

            {# the modal itself - hidden until above button shows it #}
            {% include 'delete_modal_snippet.html' with delete_object=project delete_url='delete-project' %}
        {% endif %}
    </p>

    <p><strong>Owner</strong>:
        {% if project.owner %}
            <a href="{% url 'user-detail' project.owner.pk %}">{{ project.owner.username }}</a>
        {% else %}
            <small class="text-muted">(No owner)</small>
        {% endif %}
    </p>
    <p><strong>Public?</strong> {{ project.is_public|yesno }}</p>
    <p><strong>Description</strong>: {{ project.description }}</p>
    <p><strong>Home</strong>: <a href="{{ project.home_url }}">{{ project.home_url }}</a></p>
    <p><strong>Core data</strong>: <a href="{{ project.core_data }}">{{ project.core_data }}</a></p>
    <p><strong>Template data</strong>:
        {% if project.csv_filename %}
            <a href="{% url 'template-data-detail' project.pk %}">{{ project.csv_filename }}</a>
        {% else %}
            <small class="text-muted">(No template)</small>
        {% endif %}
    </p>
    <p><strong>Visualizations</strong>: <a href="{% url 'project-visualizations' project.pk %}">Here</a></p>


    <h2>Model Owners</h2>

    {% if project.model_owners.all %}
        <ul>
            {% for model_owner in project.model_owners.all %}
                <li><a href="{% url 'user-detail' model_owner.pk %}">{{ model_owner.username }}</a></li>
            {% endfor %}
        </ul>
    {% else %}
        <small class="text-muted">(No model owners)</small>
    {% endif %}


    <h2>Models ({{ project.models.all|length }})
        {% if ok_user_create_model %}
            &nbsp;<a href="{% url 'create-model' project.pk %}" class="btn btn-success" role="button">New</a>
        {% endif %}
    </h2>

    {% if project.models.all %}
        <ul>
            {% for forecast_model in project.models.all %}
                <li><a href="{{ forecast_model.get_absolute_url }}">{{ forecast_model.name }}</a></li>
            {% endfor %}
        </ul>
    {% else %}
        <small class="text-muted">(No models)</small>
    {% endif %}


    <h2>Targets ({{ project.targets.all|length }})</h2>

    {% if project.targets.all %}
        <ul>
            {% for target in project.targets.all %}
                <li><strong>{{ target.name }}</strong>: {{ target.description }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <small class="text-muted">(No targets)</small>
    {% endif %}


    <h2>TimeZeros & Data Version Dates ({{ project.timezeros.all|length }})</h2>

    {% if project.timezeros.all %}
        <div class="col-sm-8">
            <table class="table table-striped table-bordered">
                <tr>
                    <th>Time Zero</th>
                    <th>Data Version Date</th>
                    <th># Forecasts</th>
                </tr>
                {% for timezero, num_forecasts in timezeros_to_num_forecasts.items %}
                    <tr>
                        <td>{{ timezero.timezero_date|date:"Y-m-d" }}</td>
                        <td>
                            {% if timezero.data_version_date %}
                                &nbsp; @ {{ timezero.data_version_date|date:"Y-m-d" }}
                            {% else %}
                                <small class="text-muted">(No data version date)</small>
                            {% endif %}
                        </td>
                        <td>{{ num_forecasts }}</td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    {% else %}
        <small class="text-muted">(No TimeZeros)</small>
    {% endif %}

{% endblock %}